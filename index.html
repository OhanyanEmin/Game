<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üéÆ –¢–∞–π–Ω—ã–π –º–∏–Ω–∏-–∫–≤–µ—Å—Ç</title>
  <style>
    :root { --text:#f4f7ff; --muted:#a7b0d8; --accent:#8b5cf6; --accent2:#22d3ee; }
    body {margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:radial-gradient(circle at 20% 10%,#1a2050,#0a0d22 60%,#040614 100%);color:var(--text);overflow-x:hidden;}
    .app{max-width:900px;margin:0 auto;min-height:100%;padding:32px 16px 120px;}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.08);border-radius:20px;padding:24px;backdrop-filter:blur(8px);box-shadow:0 10px 40px rgba(0,0,0,0.35)}
    h1,h2{margin:0 0 12px;} h1{font-size:clamp(28px,5vw,40px);} h2{font-size:clamp(22px,4vw,30px);} p{color:var(--muted);margin:8px 0 16px;}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    button{padding:12px 16px;border-radius:12px;border:0;font-weight:700;cursor:pointer;font-size:16px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0b0e22;box-shadow:0 10px 20px rgba(139,92,246,.35),inset 0 1px 0 rgba(255,255,255,.3);}button:hover{transform:translateY(-1px);filter:brightness(1.05);}button:active{transform:translateY(1px);} 
    .stage{margin-top:24px;display:none}.stage.active{display:block}

    /* Balloons */
    #balloonStage{position:relative;height:420px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));border-radius:16px;border:1px solid rgba(255,255,255,0.08)}
    .hud{display:flex;gap:16px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    .pill{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);padding:8px 12px;border-radius:999px;font-weight:700}
    .balloon{position:absolute;width:56px;height:72px;border-radius:50% 50% 48% 48%;cursor:pointer;box-shadow:inset 0 -6px 16px rgba(0,0,0,.35),0 8px 20px rgba(0,0,0,.25)}.balloon::after{content:"";position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:8px;height:12px;background:currentColor;border-radius:2px}.pop{animation:pop 250ms ease-out forwards}@keyframes pop{to{transform:scale(1.2);opacity:0}}

    /* Quiz */
    .qbox{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:16px}
    .opt{display:flex;align-items:center;gap:10px;margin:10px 0;padding:10px 12px;border-radius:12px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);cursor:pointer}
    .opt:hover{filter:brightness(1.05)}

    /* Dodge */
    #dodgeArea{position:relative;height:340px;border-radius:16px;border:1px dashed rgba(255,255,255,0.2);display:grid;place-items:center;overflow:hidden}
    #trickyBtn{position:absolute}

    /* Finale & UI */
    #confettiCanvas{position:fixed;inset:0;pointer-events:none}
    .toast{position:fixed;left:50%;top:18%;transform:translateX(-50%) scale(0.9);background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.22);padding:10px 14px;border-radius:999px;font-weight:800;opacity:0;transition:opacity .15s, transform .15s;}
    .toast.show{opacity:1;transform:translateX(-50%) scale(1)}

    /* Bigger finale */
    .type{font-weight:900;letter-spacing:.6px;font-size:clamp(36px,6vw,64px);text-shadow:0 6px 24px rgba(0,0,0,.35)}
    .wish{font-size:clamp(16px,2.4vw,20px);line-height:1.6}
    .final-row{display:grid;gap:14px;margin-top:12px}
    .miniQ .opt{background:rgba(255,255,255,0.06)}
  </style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>
  <div class="app">
    <div class="card">
      <h1>üéÆ –¢–∞–π–Ω—ã–π –º–∏–Ω–∏-–∫–≤–µ—Å—Ç</h1>
      <p>–¢—Ä–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è, –≤ –∫–æ–Ω—Ü–µ ‚Äî –Ω–µ—á—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ üòâ</p>

      <div class="row"><button id="startBtn">–ù–∞—á–∞—Ç—å</button></div>

      <!-- Stage 1: Balloons -->
      <div id="stage1" class="stage">
        <div class="hud">
          <span class="pill">üéà –õ–æ–ø–Ω–∏ <b id="needCount">10</b> —à–∞—Ä–∏–∫–æ–≤</span>
          <span class="pill">‚è±Ô∏è <b id="timeLeft">10</b>—Å</span>
          <button id="retry1" class="ghostBtn" style="margin-left:auto;display:none;">–ï—â—ë —Ä–∞–∑</button>
        </div>
        <div id="balloonStage"></div>
      </div>

      <!-- Stage 2: Quiz (one-by-one) -->
      <div id="stage2" class="stage">
        <h2>–≠—Ç–∞–ø 2 ‚Äî –°–∞–º–∞—è —Å—Ç—Ä–∞–Ω–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞</h2>
        <div id="qBox" class="qbox"></div>
      </div>

      <!-- Stage 3: Dodge Button -->
      <div id="stage3" class="stage">
        <h2>–≠—Ç–∞–ø 3 ‚Äî –ü–æ–π–º–∞–π –∫–Ω–æ–ø–∫—É (–æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ)</h2>
        <p>–ö–Ω–æ–ø–∫–∞ —É–¥–∏—Ä–∞–µ—Ç –æ—Ç –∫—É—Ä—Å–æ—Ä–∞. –ù–æ –µ—Å–ª–∏ –∏–≥—Ä–∞—Ç—å —É–º–Ω–æ –∏ —Ç–µ—Ä–ø–µ–ª–∏–≤–æ ‚Äî –µ—ë –º–æ–∂–Ω–æ –ø–æ–π–º–∞—Ç—å üòâ</p>
        <div id="dodgeArea" class="card" style="background:rgba(255,255,255,0.03);">
          <button id="trickyBtn">–ù–∞–∂–º–∏ –º–µ–Ω—è üòà</button>
        </div>
      </div>

      <!-- Finale -->
      <div id="stage4" class="stage">
        <h2 class="type" id="finalMsg">üéâ –° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, –ê–Ω–Ω–∞!</h2>
        <p id="subMsg" class="wish">–¢—ã –ø—Ä–æ—à–ª–∞ –∫–≤–µ—Å—Ç. –ñ–µ–ª–∞–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ö–∏—Ö–∏–∫–æ–≤ –≤ –º–∏–Ω—É—Ç—É —Å–µ–≥–æ–¥–Ω—è!</p>
        
        <!-- Extra surprise question container -->
        <div id="extraQ" class="qbox miniQ" style="display:none; margin-top:14px;"></div>

        <div class="final-row"><button id="againBtn">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">‚úîÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–æ!</div>

  <script>
    // ===== Constants & helpers =====
    const $ = s => document.querySelector(s);
    const STAGES = ['stage1','stage2','stage3','stage4'];
    const COLORS = ['#f472b6','#60a5fa','#34d399','#fbbf24','#c084fc','#2dd4bf','#fb7185'];
    const NAME = 'Anna';

    function show(id){ STAGES.forEach(s => { const el = document.getElementById(s); if(!el) return; el.classList.toggle('active', s===id); }); }
    function toastOK(){ const el = $('#toast'); el.textContent = '‚úîÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–æ!'; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),700); }

    // Sparkle chime
    function playChime(){ try{ const ac = new (window.AudioContext||window.webkitAudioContext)(); const t = ac.currentTime; const o = ac.createOscillator(); const g = ac.createGain(); o.type='sine'; o.frequency.setValueAtTime(880,t); o.frequency.exponentialRampToValueAtTime(1320,t+0.08); g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.3,t+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t+0.25); o.connect(g); g.connect(ac.destination); o.start(t); o.stop(t+0.28);}catch(e){} }

    // Simple applause using noise bursts (no external files)
    function playApplause(){
      try{
        const ac = new (window.AudioContext||window.webkitAudioContext)();
        const now = ac.currentTime;
        function burst(at, dur=0.25, vol=0.4){
          const bufferSize = ac.sampleRate * dur;
          const buffer = ac.createBuffer(1, bufferSize, ac.sampleRate);
          const data = buffer.getChannelData(0);
          for(let i=0;i<bufferSize;i++){ data[i] = (Math.random()*2-1) * Math.exp(-3*i/bufferSize); }
          const src = ac.createBufferSource(); src.buffer = buffer;
          const g = ac.createGain(); g.gain.value = vol;
          src.connect(g); g.connect(ac.destination);
          src.start(at);
        }
        // a few staggered bursts to mimic claps
        for(let i=0;i<6;i++){ burst(now + 0.05*i, 0.22, 0.35); }
        for(let i=0;i<8;i++){ burst(now + 0.5 + 0.06*i, 0.18, 0.3); }
      }catch(e){}
    }

    // ===== Stage 1: 10s Balloons =====
    const GOAL = 10; let popped = 0, timer = 10, timerId = null, running = false;

    function startStage1(){
      show('stage1');
      $('#needCount').textContent = GOAL; $('#timeLeft').textContent = 10; $('#retry1').style.display = 'none';
      const area = $('#balloonStage'); area.innerHTML = '';
      popped = 0; timer = 10; running = true;
      spawnBalloons(area, 18);
      timerId = setInterval(()=>{ timer--; $('#timeLeft').textContent = timer; if(timer <= 0){ endStage1(false); } }, 1000);
    }

    function spawnBalloons(area, n){
      const { width, height } = area.getBoundingClientRect();
      for(let i=0;i<n;i++){
        const b = document.createElement('div'); b.className = 'balloon';
        const color = COLORS[Math.floor(Math.random()*COLORS.length)];
        b.style.color = color;
        b.style.background = `radial-gradient(circle at 30% 30%, rgba(255,255,255,0.85), ${color} 60%, ${color})`;
        const x = Math.random()*(width-60);
        const startY = height + Math.random()*120 + 40;
        b.style.left = x+"px"; b.style.top = startY+"px";
        const speed = 0.9 + Math.random()*1.0;
        const sway = (Math.random()*0.5+0.2) * (Math.random()<0.5?-1:1);
        let y = startY; let t = Math.random()*1000; let alive = true;
        const move = () => {
          if(!alive) return; t += 0.02; y -= speed; const dx = Math.sin(t)*8*sway; b.style.transform = `translateX(${dx}px)`; b.style.top = y+"px";
          if(y < -80){ alive = false; b.remove(); maybeRespawn(area); }
          else requestAnimationFrame(move);
        };
        b.addEventListener('click', () => {
          if(!running) return; alive = false; b.classList.add('pop');
          setTimeout(()=>{ b.remove(); maybeRespawn(area); }, 220);
          popped++; if(popped >= GOAL){ endStage1(true); }
        });
        area.appendChild(b); requestAnimationFrame(move);
      }
    }
    function maybeRespawn(area){ if(running && popped < GOAL) spawnBalloons(area, 1); }
    function endStage1(success){ running = false; clearInterval(timerId); timerId = null; if(success){ setTimeout(()=>startStage2(), 350); } else { $('#retry1').style.display = 'inline-flex'; $('#retry1').onclick = startStage1; } }

    // ===== Stage 2: Quiz (5 rounds) =====
    const QUESTIONS = [
      {q:'–ß—Ç–æ —Å–∫–∞–∑–∞–ª–∞ –±—ã –∫–æ—à–∫–∞, –µ—Å–ª–∏ –±—ã —É–º–µ–ª–∞ –≥–æ–≤–æ—Ä–∏—Ç—å?', opts:['‚Äú–¢—ã –æ–ø—è—Ç—å –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ?‚Äù','‚Äú–ö–æ—Ä–º–∏ –±—ã—Å—Ç—Ä–µ–µ‚Äù','‚Äú–Ø –º–µ–Ω–µ–¥–∂–µ—Ä —ç—Ç–æ–≥–æ –¥–æ–º–∞‚Äù'], correct:1},
      {q:'–ö–∞–∫–æ–π —Å—É–ø–µ—Ä—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é –æ–±–ª–∞–¥–∞–µ—Ç —Ç–∞–ø–æ–∫?', opts:['–£–Ω–∏—á—Ç–æ–∂–∞–µ—Ç –Ω–∞—Å–µ–∫–æ–º—ã—Ö','–ò—Å—á–µ–∑–∞–µ—Ç, –∫–æ–≥–¥–∞ –µ–≥–æ –∏—â—É—Ç','–ü—Ä–∏–∑—ã–≤–∞–µ—Ç –≤—Ç–æ—Ä–æ–π —Ç–∞–ø–æ–∫'], correct:1},
      {q:'–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫, –∫–æ–≥–¥–∞ –∏—â–µ—Ç –ø—É–ª—å—Ç?', opts:['–ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤–µ—Å—å –¥–∏–≤–∞–Ω','–ó–æ–≤—ë—Ç —Å–æ—Å–µ–¥–∞','–ü–æ–∫—É–ø–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–µ–ª–µ–≤–∏–∑–æ—Ä'], correct:0},
      {q:'–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Ç—ã –≤–∑—Ä–æ—Å–ª—ã–π?', opts:['–†–∞–¥–æ—Å—Ç—å –æ—Ç –Ω–æ–≤—ã—Ö –Ω–æ—Å–∫–æ–≤','–õ—é–±–∏—à—å —Å—É–ø','–ü–æ–Ω–∏–º–∞–µ—à—å —à—É—Ç–∫–∏ –ø—Ä–æ –∫—Ä–µ–¥–∏—Ç—ã'], correct:2},
      {q:'–ß—Ç–æ —Å–∞–º–æ–µ —Å—Ç—Ä–∞—à–Ω–æ–µ, –∫–æ–≥–¥–∞ —Ä–µ–∂–µ—à—å –ª—É–∫?', opts:['–°–ª—ë–∑—ã','–í—Å–ø–æ–º–∏–Ω–∞–µ—à—å –≤—Å–µ –æ—à–∏–±–∫–∏ 2014 –≥–æ–¥–∞','–õ—É–∫ —Ä–µ–∂–µ—Ç —Ç–µ–±—è –≤ –æ—Ç–≤–µ—Ç'], correct:1}
    ];
    let qi = 0;

    function startStage2(){ show('stage2'); qi = 0; renderQ(); }
    function renderQ(){
      const box = $('#qBox'); const item = QUESTIONS[qi];
      box.innerHTML = `<div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px;"><div class="pill">–í–æ–ø—Ä–æ—Å ${qi+1}/5</div></div><div style="font-weight:800;font-size:18px;margin-bottom:10px;">${item.q}</div>`;
      item.opts.forEach((text, idx) => { const btn = document.createElement('div'); btn.className = 'opt'; btn.innerHTML = `<span style="font-weight:800;opacity:.8">${String.fromCharCode(65+idx)})</span> <span>${text}</span>`; btn.onclick = () => selectAnswer(idx === item.correct); box.appendChild(btn); });
    }
    function selectAnswer(ok){ if(!ok){ alert('‚ùå –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!'); return; } toastOK(); playChime(); setTimeout(() => { if(qi < QUESTIONS.length - 1){ qi++; renderQ(); } else { startStage3(); } }, 800); }

    // ===== Stage 3: Dodge (hard but possible) =====
    function startStage3(){ show('stage3'); const area = $('#dodgeArea'); const btn = $('#trickyBtn'); let radiusX = 120, radiusY = 80; const minRX = 45, minRY = 30; let evadeCount = 0; let moving = false; const t0 = performance.now(); const shrink = setInterval(()=>{ radiusX = Math.max(minRX, radiusX - 6); radiusY = Math.max(minRY, radiusY - 4); }, 1500); function moveButton(){ const r = area.getBoundingClientRect(); const bw = btn.offsetWidth || 120; const bh = btn.offsetHeight || 44; const x = Math.random() * (r.width - bw - 20) + 10; const y = Math.random() * (r.height - bh - 20) + 10; btn.style.left = x + 'px'; btn.style.top  = y + 'px'; moving = false; } function maybeDodge(x, y){ const rect = btn.getBoundingClientRect(); const dx = Math.abs(x - (rect.left + rect.width/2)); const dy = Math.abs(y - (rect.top  + rect.height/2)); if(dx < radiusX && dy < radiusY && !moving){ moving = true; evadeCount++; const tired = (performance.now() - t0 > 9000) || (evadeCount > 18); const delay = tired ? 90 : 0; setTimeout(moveButton, delay); } } area.onmousemove = e => maybeDodge(e.clientX, e.clientY); area.ontouchmove = e => { if(e.touches && e.touches[0]){ const t = e.touches[0]; maybeDodge(t.clientX, t.clientY); } }; btn.onclick = () => { clearInterval(shrink); finish(); }; moveButton(); }

    // ===== Finale =====
    function finish(){
      show('stage4');
      // Bigger, punchy message in Russian with emojis
      $('#finalMsg').textContent = `üéâ –° 19‚Äë–ª–µ—Ç–∏–µ–º, ${NAME}! üéÇ‚ú®`;
      $('#subMsg').innerHTML = `–ü—É—Å—Ç—å —ç—Ç–æ—Ç –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å—ë—Ç —Ç–µ–±–µ –º–æ—Ä–µ —Ä–∞–¥–æ—Å—Ç–∏, —Ç—ë–ø–ª—ã–µ –æ–±—ä—è—Ç–∏—è, –±–æ–ª—å—à–∏–µ –ø–æ–±–µ–¥—ã –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–º–µ—Ö. ü•≥üç∞`;
      runConfetti(4200);
      playApplause();

      // Extra surprise question (in Russian; only word Steve stays in English)
      const box = $('#extraQ');
      box.style.display = 'block';
      box.innerHTML = `
        <div style="font-weight:800;font-size:18px;margin-bottom:10px;">–û—Ç–≤–µ—Ç—å –Ω–∞ –µ—â—ë –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å ‚Äî –∏ –ø–æ–ª—É—á–∏ –µ—â—ë –æ–¥–∏–Ω —Å—é—Ä–ø—Ä–∏–∑!</div>
        <div style="margin-bottom:10px">–ö—Ç–æ —Ç–∞–∫–æ–π <b>Steve</b>?</div>
      `;
      [
        {t:'–ú–∞—Ä–∏–∞–º', ok:false},
        {t:'–≠–º–∏–Ω', ok:false},
        {t:'–ê–Ω–Ω–∞', ok:true}
      ].forEach((o,idx)=>{
        const btn=document.createElement('div');
        btn.className='opt';
        btn.innerHTML=`<span style="font-weight:800;opacity:.8">${String.fromCharCode(65+idx)})</span> <span>${o.t}</span>`;
        btn.onclick=()=>{
          if(o.ok){
            toastOK(); playChime();
            const msg=document.createElement('div');
            msg.style.marginTop='10px';
            msg.style.fontWeight='800';
            msg.style.lineHeight='1.5';
            msg.innerHTML='–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –£–≤–∏–¥–∏–º—Å—è –≤ –ú–æ—Å–∫–≤–µ! –£ –Ω–∞—Å –±—É–¥–µ—Ç —Å—Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç–∞–º!!!';
            box.appendChild(msg);
            runConfetti(3000);
            playApplause();
          } else {
            alert('‚ùå –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!');
          }
        };
        box.appendChild(btn);
      });
    }

    $('#startBtn').addEventListener('click', startStage1);
    $('#againBtn').addEventListener('click', ()=>location.reload());

    // ===== Confetti =====
    const confettiCanvas = document.getElementById('confettiCanvas');
    const ctx = confettiCanvas.getContext('2d');
    const confetti = []; let confettiRAF = null;
    function resize(){ confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight; }
    addEventListener('resize', resize); resize();

    function spawnConfetti(n){
      for(let i=0;i<n;i++){
        confetti.push({ x: Math.random()*confettiCanvas.width, y: -20 - Math.random()*200, vx: (Math.random()-0.5)*2, vy: 2 + Math.random()*2.5, size: 5 + Math.random()*6, rot: Math.random()*Math.PI, vr: (Math.random()-0.5)*0.2, color: COLORS[Math.floor(Math.random()*COLORS.length)] });
      }
    }
    function drawConfetti(){
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      confetti.forEach(p=>{ p.x += p.vx; p.y += p.vy; p.rot += p.vr; if(p.y > confettiCanvas.height + 20) { p.y = -10; p.x = Math.random()*confettiCanvas.width; } ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot); ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size); ctx.restore(); });
      confettiRAF = requestAnimationFrame(drawConfetti);
    }
    function runConfetti(ms){ spawnConfetti(220); if(!confettiRAF) drawConfetti(); setTimeout(()=>{ cancelAnimationFrame(confettiRAF); confettiRAF = null; }, ms); }
  </script>
</body>
</html>
